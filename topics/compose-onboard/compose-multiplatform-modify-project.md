[//]: # (title: Modify the project)
<tldr>
   <p>This is the third part of the <strong>Create a Compose Multiplatform app with shared logic and UI</strong> tutorial. Before proceeding, make sure you've completed previous steps.</p>
   <p><img src="icon-1-done.svg" width="20" alt="First step"/> <a href="compose-multiplatform-create-first-app.md">Create your Compose Multiplatform app</a><br/>
       <img src="icon-2-done.svg" width="20" alt="Second step"/> <a href="compose-multiplatform-explore-composables.md">Explore composable code</a><br/>
       <img src="icon-3.svg" width="20" alt="Third step"/> <strong>Modify the project</strong><br/>
       <img src="icon-4-todo.svg" width="20" alt="Fourth step"/> Create your own application<br/>
  </p>
</tldr>

Let's modify the code generated by the Kotlin Multiplatform wizard and display the current date within the `App`
composable. To do this, you'll add a new dependency to the project, enhance the UI, and rerun the application on each
platform.

## Add a new dependency

You could retrieve the date using platform-specific libraries and [expected and actual declarations](https://kotlinlang.org/docs/multiplatform-expect-actual.html).
But we recommend that you use this approach only when there's no Kotlin Multiplatform library available. In this case,
you can rely on the [kotlinx-datetime](https://github.com/Kotlin/kotlinx-datetime) library.

> You can explore Kotlin Multiplatform libraries available for your target platforms on [klibs.io](https://klibs.io/),
> an experimental search service from JetBrains for discovering multiplatform libraries.
>
{style="tip"}

To use the `kotlinx-datetime` library:

1. Open the `composeApp/build.gradle.kts` file and add it as a dependency to the project.

    ```kotlin
    kotlin {
        // ...
        sourceSets {
            // ...
            commonMain.dependencies {
                // ...
                implementation("org.jetbrains.kotlinx:kotlinx-datetime:%dateTimeVersion%")
            }
            wasmJsMain.dependencies {
                implementation(npm("@js-joda/timezone", "2.3.0"))
            }
        }
    }
    
    ```

    * The main dependency is added to the section that configures the common code source set.
    * For simplicity, the version number is included directly instead of being added to the version catalog.
    * To support timezones in the web target, the reference to the necessary npm package is included in `wasmJsMain`
     dependencies.

2. Once the dependency is added, you're prompted to resync the project. Click the **Sync Gradle Changes** button to synchronize Gradle files: ![Synchronize Gradle files](gradle-sync.png){width=50}

3. In the terminal, navigate to your project directory and run:

    ```shell
    ./gradlew wasmKotlinUpgradeYarnLock
    ```

   This Gradle task ensures that the `yarn.lock` file is updated with the latest dependency versions.

## Enhance the user interface

1. Open the `composeApp/src/commonMain/kotlin/App.kt` file and add the following function which returns a string containing the current date:

   ```kotlin
   fun todaysDate(): String {
       fun LocalDateTime.format() = toString().substringBefore('T')

       val now = Clock.System.now()
       val zone = TimeZone.currentSystemDefault()
       return now.toLocalDateTime(zone).format()
   }
   ```

2. In the same file, modify the `App()` composable to include the `Text()` composable that invokes this function and displays the result:
   
    ```kotlin
    @Composable
    @Preview
    fun App() {
        MaterialTheme {
            var showContent by remember { mutableStateOf(false) }
            val greeting = remember { Greeting().greet() }
            Column(Modifier.fillMaxWidth(), horizontalAlignment = Alignment.CenterHorizontally) {
                Text(
                    text = "Today's date is ${todaysDate()}",
                    modifier = Modifier.padding(20.dp),
                    fontSize = 24.sp,
                    textAlign = TextAlign.Center
                )
                Button(onClick = { showContent = !showContent }) {
                    Text("Click me!")
                }
                AnimatedVisibility(showContent) {
                    Column(Modifier.fillMaxWidth(), horizontalAlignment = Alignment.CenterHorizontally) {
                        Image(painterResource(Res.drawable.compose_multiplatform), null)
                        Text("Compose: $greeting")
                    }
                }
            }
        }
    }
    ```

3. Follow the IDE's suggestions to import the missing dependencies.

   ![Unresolved references](compose-unresolved-references.png)

4. Switch the web app from using an `Element` as a container to an HTML element with an externally specified `id`:

    1. In the `composeApp/src/wasmJsMain/resources/index.html` file, add a named element within the `<body>`:

        ```html
        <body>
        <div id="composeApplication" style="width:400px; height: 500px;"></div>
        </body>
        ```
    2. In the `composeApp/src/wasmJsMain/kotlin/main.kt` file, change the `ComposeViewport` call to the `String` variant,
        pointing to the ID you specified in the HTML file:

        ```kotlin
        @OptIn(ExperimentalComposeUiApi::class)
        fun main() {
            ComposeViewport(viewportContainerId = "composeApplication") {
                App()
            }
        }
        ```

## Rerun the application

You can now rerun the application using the same run configurations for Android, iOS, desktop, and web:

![First Compose Multiplatform app on Android and iOS](first-compose-project-on-android-ios-2.png){width=500}

![First Compose Multiplatform app on desktop](first-compose-project-on-desktop-2.png){width=400}

![First Compose Multiplatform app on web](first-compose-project-on-web-2.png){width=400}

> You can find this state of the project in our [GitHub repository](https://github.com/kotlin-hands-on/get-started-with-cm/tree/main/ComposeDemoStage1).
>
{style="tip"}

## Next step

In the next part of the tutorial, you'll learn new Compose Multiplatform concepts and create your own application from
scratch.

**[Proceed to the next part](compose-multiplatform-new-project.md)**

## Get help

* **Kotlin Slack**. Get an [invite](https://surveys.jetbrains.com/s3/kotlin-slack-sign-up) and join
  the [#multiplatform](https://kotlinlang.slack.com/archives/C3PQML5NU) channel.
* **Kotlin issue tracker**. [Report a new issue](https://youtrack.jetbrains.com/newIssue?project=KT).

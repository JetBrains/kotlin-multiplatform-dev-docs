[//]: # (title: Modify the project)

<secondary-label ref="IntelliJ IDEA"/>
<secondary-label ref="Android Studio"/>

<tldr>
    <p>This tutorial uses IntelliJ IDEA, but you can also follow it in Android Studio â€“ both IDEs share the same core functionality and Kotlin Multiplatform support.</p>
    <br/>
    <p>This is the third part of the <strong>Create a Compose Multiplatform app with shared logic and UI</strong> tutorial. Before proceeding, make sure you've completed previous steps.</p>
    <p><img src="icon-1-done.svg" width="20" alt="First step"/> <a href="compose-multiplatform-create-first-app.md">Create your Compose Multiplatform app</a><br/>
       <img src="icon-2-done.svg" width="20" alt="Second step"/> <a href="compose-multiplatform-explore-composables.md">Explore composable code</a><br/>
       <img src="icon-3.svg" width="20" alt="Third step"/> <strong>Modify the project</strong><br/>
       <img src="icon-4-todo.svg" width="20" alt="Fourth step"/> Create your own application<br/>
    </p>
</tldr>

Let's modify the code generated by the Kotlin Multiplatform wizard and display the current date within the `App`
composable. To do this, you'll add a new dependency to the project, enhance the UI, and rerun the application on each
platform.

## Add a new dependency

You could retrieve the date using platform-specific libraries and [expected and actual declarations](multiplatform-expect-actual.md).
But we recommend that you use this approach only when there's no Kotlin Multiplatform library available. In this case,
you can rely on the [kotlinx-datetime](https://github.com/Kotlin/kotlinx-datetime) library.

> You can explore Kotlin Multiplatform libraries available for your target platforms on [klibs.io](https://klibs.io/),
> an experimental search service from JetBrains for discovering multiplatform libraries.
>
{style="tip"}

To use the `kotlinx-datetime` library:

1. Open the `composeApp/build.gradle.kts` file and add the dependencies to the project:

    * Add the main `kotlinx-datetime` dependency to the section that configures the common code source set.
      For simplicity, you can include the version number directly instead of adding it to the version catalog.
    * For the web target, timezone support requires the `js-joda` library. 
      Add a reference to the `js-joda` npm package in the `webMain` dependencies.
      
    ```kotlin
    kotlin {
        // ...
        sourceSets {
            // ...
            commonMain.dependencies {
                // ...
                implementation("org.jetbrains.kotlinx:kotlinx-datetime:%dateTimeVersion%")
            }
            webMain.dependencies {
                implementation(npm("@js-joda/timezone", "2.22.0"))
            }
        }
    }
    
    ```
    
2. Once the dependency is added, you're prompted to resync the project. Click the **Sync Gradle Changes** button to synchronize Gradle files: ![Synchronize Gradle files](gradle-sync.png){width=50}

3. In the **Terminal** tool window, run the following command:

    ```shell
    ./gradlew kotlinUpgradeYarnLock kotlinWasmUpgradeYarnLock
    ```

   This Gradle task ensures that the `yarn.lock` file is updated with the latest dependency versions.
 
4. In the `webMain` source set, use the `@JsModule` annotation to import the `js-joda` npm package: 

    ```kotlin
    import androidx.compose.ui.ExperimentalComposeUiApi
    import androidx.compose.ui.window.ComposeViewport
    import kotlin.js.ExperimentalWasmJsInterop
    import kotlin.js.JsModule

    @OptIn(ExperimentalWasmJsInterop::class)
    @JsModule("@js-joda/timezone")
    external object JsJodaTimeZoneModule
    
    private val jsJodaTz = JsJodaTimeZoneModule
    
    @OptIn(ExperimentalComposeUiApi::class)
    fun main() {
        ComposeViewport {
            App()
        }
    }
    ```
   {initial-collapse-state="collapsed" collapsible="true" collapsed-title='@JsModule("@js-joda/timezone")'}

## Enhance the user interface

1. Open the `composeApp/src/commonMain/kotlin/App.kt` file and add the following function which returns a string containing the current date:

   ```kotlin
   fun todaysDate(): String {
       fun LocalDateTime.format() = toString().substringBefore('T')

       val now = Clock.System.now()
       val zone = TimeZone.currentSystemDefault()
       return now.toLocalDateTime(zone).format()
   }
   ```
2. Add the imports that are suggested by the IDE. Make sure to import the `Clock` class from `kotlin.time`, **not** `kotlinx.datetime`. 
3. In the same file, modify the `App()` composable to include the `Text()` composable that invokes this function and displays the result:
   
    ```kotlin
    @Composable
    @Preview
    fun App() {
        MaterialTheme {
            var showContent by remember { mutableStateOf(false) }
            val greeting = remember { Greeting().greet() }
            Column(
                modifier = Modifier
                    .safeContentPadding()
                    .fillMaxSize(),
                horizontalAlignment = Alignment.CenterHorizontally
            ) {
                Text(
                    text = "Today's date is ${todaysDate()}",
                    modifier = Modifier.padding(20.dp),
                    fontSize = 24.sp,
                    textAlign = TextAlign.Center
                )
                Button(onClick = { showContent = !showContent }) {
                    Text("Click me!")
                }
                AnimatedVisibility(showContent) {
                    Column(Modifier.fillMaxWidth(), horizontalAlignment = Alignment.CenterHorizontally) {
                        Image(painterResource(Res.drawable.compose_multiplatform), null)
                        Text("Compose: $greeting")
                    }
                }
            }
        }
    }
    ```

4. Follow the IDE's suggestions to import the missing dependencies.
   Make sure to import all the missing dependencies for the `todaysDate()` function from the updated packages, and
   opt in when prompted by the IDE.

   ![Unresolved references](compose-unresolved-references.png)

## Rerun the application

You can now [rerun the application](compose-multiplatform-create-first-app.md#run-your-application) 
using the same run configurations for Android, iOS, desktop, and web:

<tabs>
    <tab id="mobile-app" title="Android and iOS">
        <img src="first-compose-project-on-android-ios-2.png" alt="First Compose Multiplatform app on Android and iOS" width="500"/>
    </tab>
    <tab id="desktop-app" title="Desktop">
        <img src="first-compose-project-on-desktop-2.png" alt="First Compose Multiplatform app on desktop" width="400"/>
    </tab>
    <tab id="web-app" title="Web">
        <img src="first-compose-project-on-web-2.png" alt="First Compose Multiplatform app on web" width="400"/>
    </tab>
</tabs>

## Next step

In the next part of the tutorial, you'll learn new Compose Multiplatform concepts and create your own application from
scratch.

**[Proceed to the next part](compose-multiplatform-new-project.md)**

## Get help

* **Kotlin Slack**. Get an [invite](https://surveys.jetbrains.com/s3/kotlin-slack-sign-up) and join
  the [#multiplatform](https://kotlinlang.slack.com/archives/C3PQML5NU) channel.
* **Kotlin issue tracker**. [Report a new issue](https://youtrack.jetbrains.com/newIssue?project=KT).
